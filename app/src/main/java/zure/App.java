/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package zure;

import java.sql.Connection;
import java.util.List;
import java.util.Map;

import com.mongodb.client.MongoClient;

import zure.service.MongoDbService;
import zure.service.RdbService;

public class App {

    public static void main(String[] args) {
        if (args.length != 2) {
            return;
        }

        Connection connection = null;
        MongoClient mongoClient = null;
        RdbService rdbService = new RdbService();
        MongoDbService mongoDbService = new MongoDbService();
        try {

            TargetData data_A = Zure.loadDataFromFile(args[0]);
            TargetData data_B = Zure.loadDataFromFile(args[1]);

            System.out.println(">>>>>>>>>>>>>>>>>>>>>.loadDataFromFile complete");

            List<String> dataList_A = null;
            if (SourceType.isRDB(data_A.type)) {
                dataList_A = rdbService.execute(connection, data_A);
            } else if (SourceType.isNoSQL(data_A.type)) {
                dataList_A = mongoDbService.execute(mongoClient, data_A);

            } else if (SourceType.isFile(data_A.type)) {

            }
            System.out.println(">>>>>>>>>>>>>>>>>>>>>.dataList_A complete");

            List<String> dataList_B = null;
            if (SourceType.isRDB(data_B.type)) {
                dataList_B = rdbService.execute(connection, data_B);
            } else if (SourceType.isNoSQL(data_B.type)) {
                dataList_B = mongoDbService.execute(mongoClient, data_B);
            } else if (SourceType.isFile(data_B.type)) {

            }
            System.out.println(">>>>>>>>>>>>>>>>>>>>>.dataList_B complete");

            Map<String, List<String>> errorInfo = Zure.bulkCheck(dataList_A, dataList_B, data_A.targetColumns,
                    data_B.targetColumns);
            System.out.println(">>>>>>>>>>>>>>>>>>>>>.bulkCheck complete");

            // 結果出力(html or log)
            Zure.outputResultFile(errorInfo, dataList_A, dataList_B);
            System.out.println(">>>>>>>>>>>>>>>>>>>>>.outputFile complete");

        } catch (Exception e1) {
            e1.printStackTrace();
        } finally {
            try {
                if (connection != null) {
                    connection.close();
                }
                if (mongoClient != null) {
                    mongoClient.close();
                }
            } catch (Exception e2) {
                e2.printStackTrace();
            }
        }
    }
}
